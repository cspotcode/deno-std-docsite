<!DOCTYPE html><html class="default" lang="en"><head><style>body { visibility: hidden; }</style><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="IE=edge"><title>testing/snapshot | Documentation</title><meta name="description" content="Documentation for Documentation"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="../assets/style.css"><link rel="stylesheet" href="../assets/highlight.css"><script defer="" src="../assets/main.js"></script><script async="" src="../assets/icons.js" id="tsd-icons-script"></script><link rel="stylesheet" href="../assets/dmt/dmt-components.css"><link rel="stylesheet" href="../assets/dmt/dmt-theme.css"><script src="../assets/dmt/dmt-components.js" type="module"></script><noscript><style>body { visibility: visible; }</style></noscript></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";</script><div class="overlay"></div>
<main><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base=".."><div class="field" id="dmt-search-main"></div><div class="field" id="dmt-toolbar"><a href="../index.html" class="title">Documentation</a></div></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main" tabindex="-1"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"></ul><div class="dmt-title-header-flex"><h1>Module testing/snapshot</h1></div></div><section class="tsd-panel tsd-comment"><div class="tsd-comment tsd-typography"><p>A snapshotting library.</p>
<p>The <code>assertSnapshot</code> function will create a snapshot of a value and compare it
to a reference snapshot, which is stored alongside the test file in the
<code>__snapshots__</code> directory.</p>
<pre><code class="ts"><span class="hl-10">// example_test.ts</span><br><span class="hl-7">import</span><span class="hl-2"> { </span><span class="hl-8">assertSnapshot</span><span class="hl-2"> } </span><span class="hl-7">from</span><span class="hl-2"> </span><span class="hl-6">"@std/testing/snapshot"</span><span class="hl-2">;</span><br><br><span class="hl-8">Deno</span><span class="hl-2">.</span><span class="hl-9">test</span><span class="hl-2">(</span><span class="hl-6">"isSnapshotMatch"</span><span class="hl-2">, </span><span class="hl-11">async</span><span class="hl-2"> </span><span class="hl-11">function</span><span class="hl-2"> (</span><span class="hl-8">t</span><span class="hl-2">): </span><span class="hl-12">Promise</span><span class="hl-2">&lt;</span><span class="hl-12">void</span><span class="hl-2">&gt; {</span><br><span class="hl-2">  </span><span class="hl-11">const</span><span class="hl-2"> </span><span class="hl-14">a</span><span class="hl-2"> = {</span><br><span class="hl-2">    </span><span class="hl-8">hello:</span><span class="hl-2"> </span><span class="hl-6">"world!"</span><span class="hl-2">,</span><br><span class="hl-2">    </span><span class="hl-8">example:</span><span class="hl-2"> </span><span class="hl-13">123</span><span class="hl-2">,</span><br><span class="hl-2">  };</span><br><span class="hl-2">  </span><span class="hl-7">await</span><span class="hl-2"> </span><span class="hl-9">assertSnapshot</span><span class="hl-2">(</span><span class="hl-8">t</span><span class="hl-2">, </span><span class="hl-8">a</span><span class="hl-2">);</span><br><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<pre><code class="ts"><span class="hl-10">// __snapshots__/example_test.ts.snap</span><br><span class="hl-7">export</span><span class="hl-2"> </span><span class="hl-11">const</span><span class="hl-2"> </span><span class="hl-14">snapshot</span><span class="hl-2">: </span><span class="hl-12">Record</span><span class="hl-2">&lt;</span><span class="hl-12">string</span><span class="hl-2">, </span><span class="hl-12">string</span><span class="hl-2">&gt; = {};</span><br><br><span class="hl-8">snapshot</span><span class="hl-2">[</span><span class="hl-6">"isSnapshotMatch 1"</span><span class="hl-2">] = </span><span class="hl-6">`</span><br><span class="hl-6">{</span><br><span class="hl-6">  example: 123,</span><br><span class="hl-6">  hello: "world!",</span><br><span class="hl-6">}</span><br><span class="hl-6">`</span><span class="hl-2">;</span>
</code><button type="button">Copy</button></pre>

<p>Calling <code>assertSnapshot</code> in a test will throw an <code>AssertionError</code>, causing the
test to fail, if the snapshot created during the test does not match the one in
the snapshot file.</p>
<a id="md:updating-snapshots" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Updating Snapshots:<a href="#md:updating-snapshots" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>When adding new snapshot assertions to your test suite, or when intentionally
making changes which cause your snapshots to fail, you can update your snapshots
by running the snapshot tests in update mode. Tests can be run in update mode by
passing the <code>--update</code> or <code>-u</code> flag as an argument when running the test. When
this flag is passed, then any snapshots which do not match will be updated.</p>
<pre><code class="sh"><span class="hl-9">deno</span><span class="hl-2"> </span><span class="hl-6">test</span><span class="hl-2"> </span><span class="hl-11">--allow-all</span><span class="hl-2"> </span><span class="hl-11">--</span><span class="hl-2"> </span><span class="hl-11">--update</span>
</code><button type="button">Copy</button></pre>

<p>Additionally, new snapshots will only be created when this flag is present.</p>
<a id="md:permissions" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Permissions:<a href="#md:permissions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>When running snapshot tests, the <code>--allow-read</code> permission must be enabled, or
else any calls to <code>assertSnapshot</code> will fail due to insufficient permissions.
Additionally, when updating snapshots, the <code>--allow-write</code> permission must also
be enabled, as this is required in order to update snapshot files.</p>
<p>The <code>assertSnapshot</code> function will only attempt to read from and write to
snapshot files. As such, the allow list for <code>--allow-read</code> and <code>--allow-write</code>
can be limited to only include existing snapshot files, if so desired.</p>
<a id="md:options" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Options:<a href="#md:options" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>assertSnapshot</code> function optionally accepts an options object.</p>
<pre><code class="ts"><span class="hl-10">// example_test.ts</span><br><span class="hl-7">import</span><span class="hl-2"> { </span><span class="hl-8">assertSnapshot</span><span class="hl-2"> } </span><span class="hl-7">from</span><span class="hl-2"> </span><span class="hl-6">"@std/testing/snapshot"</span><span class="hl-2">;</span><br><br><span class="hl-8">Deno</span><span class="hl-2">.</span><span class="hl-9">test</span><span class="hl-2">(</span><span class="hl-6">"isSnapshotMatch"</span><span class="hl-2">, </span><span class="hl-11">async</span><span class="hl-2"> </span><span class="hl-11">function</span><span class="hl-2"> (</span><span class="hl-8">t</span><span class="hl-2">): </span><span class="hl-12">Promise</span><span class="hl-2">&lt;</span><span class="hl-12">void</span><span class="hl-2">&gt; {</span><br><span class="hl-2">  </span><span class="hl-11">const</span><span class="hl-2"> </span><span class="hl-14">a</span><span class="hl-2"> = {</span><br><span class="hl-2">    </span><span class="hl-8">hello:</span><span class="hl-2"> </span><span class="hl-6">"world!"</span><span class="hl-2">,</span><br><span class="hl-2">    </span><span class="hl-8">example:</span><span class="hl-2"> </span><span class="hl-13">123</span><span class="hl-2">,</span><br><span class="hl-2">  };</span><br><span class="hl-2">  </span><span class="hl-7">await</span><span class="hl-2"> </span><span class="hl-9">assertSnapshot</span><span class="hl-2">(</span><span class="hl-8">t</span><span class="hl-2">, </span><span class="hl-8">a</span><span class="hl-2">, {</span><br><span class="hl-2">    </span><span class="hl-10">// options</span><br><span class="hl-2">  });</span><br><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<p>You can also configure default options for <code>assertSnapshot</code>.</p>
<pre><code class="ts"><span class="hl-10">// example_test.ts</span><br><span class="hl-7">import</span><span class="hl-2"> { </span><span class="hl-8">createAssertSnapshot</span><span class="hl-2"> } </span><span class="hl-7">from</span><span class="hl-2"> </span><span class="hl-6">"@std/testing/snapshot"</span><span class="hl-2">;</span><br><br><span class="hl-11">const</span><span class="hl-2"> </span><span class="hl-14">assertSnapshot</span><span class="hl-2"> = </span><span class="hl-9">createAssertSnapshot</span><span class="hl-2">({</span><br><span class="hl-2">  </span><span class="hl-10">// options</span><br><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<p>When configuring default options like this, the resulting <code>assertSnapshot</code>
function will function the same as the default function exported from the
snapshot module. If passed an optional options object, this will take precedence
over the default options, where the value provided for an option differs.</p>
<p>It is possible to "extend" an <code>assertSnapshot</code> function which has been
configured with default options.</p>
<pre><code class="ts"><span class="hl-10">// example_test.ts</span><br><span class="hl-7">import</span><span class="hl-2"> { </span><span class="hl-8">createAssertSnapshot</span><span class="hl-2"> } </span><span class="hl-7">from</span><span class="hl-2"> </span><span class="hl-6">"@std/testing/snapshot"</span><span class="hl-2">;</span><br><span class="hl-7">import</span><span class="hl-2"> { </span><span class="hl-8">stripAnsiCode</span><span class="hl-2"> } </span><span class="hl-7">from</span><span class="hl-2"> </span><span class="hl-6">"@std/fmt/colors"</span><span class="hl-2">;</span><br><br><span class="hl-11">const</span><span class="hl-2"> </span><span class="hl-14">assertSnapshot</span><span class="hl-2"> = </span><span class="hl-9">createAssertSnapshot</span><span class="hl-2">({</span><br><span class="hl-2">  </span><span class="hl-8">dir:</span><span class="hl-2"> </span><span class="hl-6">".snaps"</span><span class="hl-2">,</span><br><span class="hl-2">});</span><br><br><span class="hl-11">const</span><span class="hl-2"> </span><span class="hl-14">assertMonochromeSnapshot</span><span class="hl-2"> = </span><span class="hl-9">createAssertSnapshot</span><span class="hl-2">&lt;</span><span class="hl-12">string</span><span class="hl-2">&gt;(</span><br><span class="hl-2">  { </span><span class="hl-8">serializer:</span><span class="hl-2"> </span><span class="hl-8">stripAnsiCode</span><span class="hl-2"> },</span><br><span class="hl-2">  </span><span class="hl-8">assertSnapshot</span><span class="hl-2">,</span><br><span class="hl-2">);</span><br><br><span class="hl-8">Deno</span><span class="hl-2">.</span><span class="hl-9">test</span><span class="hl-2">(</span><span class="hl-6">"isSnapshotMatch"</span><span class="hl-2">, </span><span class="hl-11">async</span><span class="hl-2"> </span><span class="hl-11">function</span><span class="hl-2"> (</span><span class="hl-8">t</span><span class="hl-2">): </span><span class="hl-12">Promise</span><span class="hl-2">&lt;</span><span class="hl-12">void</span><span class="hl-2">&gt; {</span><br><span class="hl-2">  </span><span class="hl-11">const</span><span class="hl-2"> </span><span class="hl-14">a</span><span class="hl-2"> = </span><span class="hl-6">"</span><span class="hl-16">\x1b</span><span class="hl-6">[32mThis green text has had its colors stripped</span><span class="hl-16">\x1b</span><span class="hl-6">[39m"</span><span class="hl-2">;</span><br><span class="hl-2">  </span><span class="hl-7">await</span><span class="hl-2"> </span><span class="hl-9">assertMonochromeSnapshot</span><span class="hl-2">(</span><span class="hl-8">t</span><span class="hl-2">, </span><span class="hl-8">a</span><span class="hl-2">);</span><br><span class="hl-2">});</span>
</code><button type="button">Copy</button></pre>

<pre><code class="ts"><span class="hl-10">// .snaps/example_test.ts.snap</span><br><span class="hl-7">export</span><span class="hl-2"> </span><span class="hl-11">const</span><span class="hl-2"> </span><span class="hl-14">snapshot</span><span class="hl-2">: </span><span class="hl-12">Record</span><span class="hl-2">&lt;</span><span class="hl-12">string</span><span class="hl-2">, </span><span class="hl-12">string</span><span class="hl-2">&gt; = {};</span><br><br><span class="hl-8">snapshot</span><span class="hl-2">[</span><span class="hl-6">"isSnapshotMatch 1"</span><span class="hl-2">] = </span><span class="hl-6">"This green text has had its colors stripped"</span><span class="hl-2">;</span>
</code><button type="button">Copy</button></pre>

<a id="md:version-control" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Version Control:<a href="#md:version-control" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Snapshot testing works best when changes to snapshot files are committed
alongside other code changes. This allows for changes to reference snapshots to
be reviewed along side the code changes that caused them, and ensures that when
others pull your changes, their tests will pass without needing to update
snapshots locally.</p>
</div><div class="tsd-comment tsd-typography"></div></section><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/denoland/std/blob/5f299ca4f9a33b8bb9d4371452879b56989f3e19/testing/snapshot.ts#L1">testing/snapshot.ts:1</a></li></ul></aside><section class="tsd-panel-group tsd-index-group"><section class="tsd-panel tsd-index-panel"><details class="tsd-index-content tsd-accordion dmt-index-content">
            <summary class="tsd-accordion-summary tsd-index-summary" data-key="index">
               <h3 class="tsd-index-heading uppercase">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="#icon-chevronSmall"></use></svg> Index
               </h3>
            </summary>
            <div class="tsd-accordion-details">
            <section class="tsd-index-section"><h3 class="tsd-index-heading">Type Aliases</h3><div class="tsd-index-list"><a href="../types/testing_snapshot.SnapshotMode.html" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-2097152"></use></svg><span>Snapshot<wbr>Mode</span></a>
<a href="../types/testing_snapshot.SnapshotOptions.html" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-2097152"></use></svg><span>Snapshot<wbr>Options</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Functions</h3><div class="tsd-index-list"><a href="../functions/testing_snapshot.assertSnapshot.html" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-64"></use></svg><span>assert<wbr>Snapshot</span></a>
<a href="../functions/testing_snapshot.createAssertSnapshot.html" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-64"></use></svg><span>create<wbr>Assert<wbr>Snapshot</span></a>
<a href="../functions/testing_snapshot.serialize.html" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-64"></use></svg><span>serialize</span></a>
</div></section></div>
         </details></section></section></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked=""><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open="" class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details" tabindex="-1"><a href="#md:updating-snapshots"><span>Updating <wbr>Snapshots:</span></a><a href="#md:permissions"><span>Permissions:</span></a><a href="#md:options"><span>Options:</span></a><a href="#md:version-control"><span>Version <wbr>Control:</span></a></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-1"></use></svg><span>Documentation</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base=".."></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a> with the <a href="https://www.npmjs.com/package/@typhonjs-typedoc/typedoc-theme-dmt" target="_blank">Default Modern Theme</a></p></footer></main></body></html>